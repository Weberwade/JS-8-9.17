<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .outer {
            width: 360px;
            height: 420px;
            border: 10px solid black;
            border-radius: 5%;
            margin: 50px auto;
            background-color: #b7d4a8;
        }

        .outer .game-frame {
            width: 304px;
            height: 304px;
            border: 2px solid black;
            margin: 20px auto;
            position: relative;
        }

        .outer .game-info {
            width: 304px;
            margin: 30px auto;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 20px;
            font-family: 'Courier New', Courier, monospace;
        }

        .food {
            width: 10px;
            height: 10px;
            position: absolute;
            display: flex;
            flex-wrap: wrap;
        }

        .food>div {
            width: 5px;
            height: 5px;
            background-color: black;
            transform: rotate(45deg);
        }

        .snake>div {
            width: 10px;
            height: 10px;
            background-color: black;
            position: absolute;
            border: #b7d4a8 1px solid;
        }
    </style>
</head>

<body>
    <div class="outer">
        <div class="game-frame">
            <div class="food">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>

            <div class="snake">
                <div></div>
            </div>
        </div>

        <div class="game-info">
            <div class="score">SCORE:<span id="score-info">0</span></div>
            <div class="level">LEVEL:<span id="level-info">1</span></div>
        </div>
    </div>

    <script>
        // 获取蛇容器
        const snake = document.getElementsByClassName('snake')[0]
        // 获取蛇身体
        const snakeBody = snake.getElementsByTagName('div')
        // 获取食物
        const food = document.getElementsByClassName('food')[0]
        // 获取分数和level的span
        const scoreInfo = document.getElementById('score-info')
        const levelInfo = document.getElementById('level-info')

        // 创建变量存储分数和等级
        let score = 0
        let level = 1


        /*
        游戏禁止掉头
            构成的要件：
            1.身体超过包括2
            2.方向不能是相反的方向
        */
        // 设定一个变量，保存上次的键盘按键内容
        let dir

        // 创建一个变量记录按键状态
        let keyActive = true

        const keyArr = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight']
        const reObj = {
            ArrowUp: 'ArrowDown',
            ArrowDown: 'ArrowUp',
            ArrowLeft: 'ArrowRight',
            ArrowRight: 'ArrowLeft'
        }
        // 绑定按键事件
        document.addEventListener("keydown", function (event) {
            if (keyActive && keyArr.includes(event.key)) {
                if (snakeBody.length < 2 || reObj[dir] !== event.key) {
                    //设置方向
                    dir = event.key
                    keyActive = false
                }
            }
        })

        // 设置一个随机食物生成函数

        function changeFood() {
            let x = Math.round(Math.random() * (29-1) + 1) * 10
            let y = Math.round(Math.random() * (29-1) + 1) * 10

            food.style.left = x + 'px'
            food.style.top = y + 'px'
        }
        changeFood()


        setTimeout(function move() {
            keyActive = true
            //获取蛇头
            const snakeHead = snakeBody[0]
            // 获取蛇头的坐标
            let headX = snakeHead.offsetLeft
            let headY = snakeHead.offsetTop
            switch (dir) {
                case 'ArrowUp':
                    // 向上移动蛇
                    headY -= 10
                    break
                case 'ArrowDown':
                    // 向下移动蛇
                    headY += 10
                    break
                case 'ArrowLeft':
                    // 向左移动蛇
                    headX -= 10
                    break
                case 'ArrowRight':
                    // 向右移动蛇
                    headX += 10
                    break
            }
            // 判断蛇头是否吃到食物
            if (snakeHead.offsetTop === food.offsetTop && snakeHead.offsetLeft === food.offsetLeft) {
                // 随机改变食物位置
                changeFood()
                // 增加蛇身
                snake.insertAdjacentHTML("beforeend",
                    '<div></div>'
                )
                scoreInfo.textContent = ++score

                // 检查等级
                if(score % 5 === 0 && level < 9){
                    level++
                    levelInfo.textContent = level
                }
            }

            /*

            判断游戏是否结束
                1.撞墙
                1.撞自己

            */
           // 判断是否撞墙
            if (headX < 0 || headX > 290 || headY < 0 || headY > 290) {
                alert('撞墙了！游戏结束，重新开始请刷新')
                return
            }
            // 判断是否装自己
            for(let i = 0; i < snakeBody.length - 1 ; i++ ){
                if(snakeBody[i].offsetLeft === headX && snakeBody[i].offsetTop === headY){
                    alert('撞自己了！游戏结束，重新开始请刷新')
                    return
                }
            }


            // 获取尾巴
            const tail = snakeBody[snakeBody.length - 1]
            //移动蛇的位置
            tail.style.top = headY + 'px'
            tail.style.left = headX + 'px'
            // 将尾巴移动到蛇头的位置
            snake.insertAdjacentElement("afterbegin", tail)




            setTimeout(move, 200 - level * 20)
        }, 200)

    </script>
</body>

</html>